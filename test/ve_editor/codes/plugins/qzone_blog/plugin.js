/*
 Qzone Project By Qzone Web Group. 
 Copyright 1998 - 2008
*/

(function(v){var is=ve.is,each=ve.each,isIE=ve.isIE,dom=ve.DOM,toolbarrows;function loadColorPickerTo(ed,n,cmd){var sc=new ve.net.ScriptLoader();var callback=function(){var opt={defaultTab:0,needFloat:true,realtime:false,cssText:''};var pickerButton=new QZFL.widget.ColorPicker(n,function(color){ed.editorcommands.execCommand(cmd,false,color);},opt);pickerButton.show();ed.onClick.add(function(){pickerButton.hide();});ed.onBeforeOpenListBox.add(function(){pickerButton.hide();});};if(!QZFL.widget.ColorPicker){sc.load('http://qzs.qq.com/ac/qzone/qzfl/lc/qzfl.widget.colorpicker.js',{callback:callback});}
else{callback();}};v.Class('ve.plugin.ForeColor',{init:function(editor,url){var t=this;t.editor=editor;t.editor.addCommand('ForeColor',function(ed,n){loadColorPickerTo(ed,n,'setForeColor');});t.editor.addButton('setForeColor',{to:'group2','class':'veForeColor',title:'设置文本颜色',cmd:'ForeColor'});}});v.plugin.register('forecolor',ve.plugin.ForeColor);v.Class('ve.plugin.BackColor',{init:function(editor,url){var t=this;t.editor=editor;t.editor.addCommand('BackColor',function(ed,n){loadColorPickerTo(ed,n,'setBackColor');});t.editor.addButton('setBackColor',{to:'group2',at:1,'class':'veBackColor',title:'设置背景颜色',cmd:'BackColor'});}});v.plugin.register('backcolor',ve.plugin.BackColor);v.Class('ve.plugin.link',{editor:null,pop:null,node:null,init:function(editor,url){this.editor=editor;this.editor.addCommand('showSetLink',ve.bind(this,function(ed,n){this.showPanel(null,n);QZFL.event.cancelBubble();}));dom.event.add(document.body,'click',ve.bind(this,function(e){var target=QZFL.event.getTarget(e);if(!QZFL.dom.isAncestor(target,this.editor.iframeContainer)){this.closePanel();}}));this.editor.onClick.add(ve.bind(this,function(e){var link=QZFL.event.getTarget(e);if(link.tagName!='A'){this.closePanel();}else{this.node=link;var href=link.href;var region=dom.getRegion(link);var iframeRegion=dom.getRegion(this.editor.iframeContainer);this.showPanel(href,null,{top:region.top+iframeRegion.top+region.height,left:region.left+iframeRegion.left});QZFL.event.cancelBubble();}}));this.editor.addButton('setLink',{to:'group4',at:5,'class':'veLink',title:'设置链接',cmd:'showSetLink'});},showPanel:function(link,node,config){var config=ve.extend({left:0,top:0},config||{});var html=(['<div id="ed-insert-link-panel"><strong>设置超链接</strong>','<div>','<input type="text" id="link-val"/>','<input type="button" value="确定" id="link-submit-btn"/>','</div></div>']).join('');if(!this.pop){this.pop=ve.ui.showSimplePopup(this.editor,node,{content:html,height:70,width:280});this.setupEvent(this.pop.getDOM());}
dom.get('link-val').value=link||'http://';this.pop.show();if(node){var region=dom.getRegion(node);config=ve.extend(config||{},{left:region.left,top:region.top+region.height});}
var toolbarContainerRegion=dom.getRegion(this.editor.toolbarContainer);var popRegion=dom.getRegion(this.pop.getDOM());if((config.left+popRegion.width)>(toolbarContainerRegion.left+toolbarContainerRegion.width)){config.left=toolbarContainerRegion.left+toolbarContainerRegion.width-popRegion.width;}
this.pop.show(config);},closePanel:function(){this.node=null;if(this.pop){this.pop.hide();}},setLink:function(){var link=dom.get('link-val').value;try{if(link==''||link=='http://'){this.editor.editorcommands.unlink();}else if(this.node){this.node.href=link;this.node=null;}else if(!this.editor.getSelection()){this.editor.setContent('<a href="'+link+'">'+link+'</a>');}else{this.editor.editorcommands.insertLink(null,link);}}catch(e){}
return true;},setupEvent:function(container){dom.event.add(dom.get('link-val'),'keydown',ve.bind(this,function(e){var e=e||window.event;if(e.keyCode==13){if(this.setLink()){this.closePanel();};QZFL.event.cancelBubble();QZFL.event.preventDefault();return false;}}));dom.event.add(dom.get('link-submit-btn'),'click',ve.bind(this,function(){if(this.setLink()){this.closePanel();};}));}});v.plugin.register('link',ve.plugin.link);v.Class('ve.plugin.ToolbarSwitcher',{editor:null,curToolbarMode:'default',button:null,init:function(editor,url){this.editor=editor;this.editor.onInitComplete.add(ve.bind(this,function(){var ToolbarContainerFull=new ve.editor.ToolbarManager(this.editor,{'class':'veToolbarAdvMode','name':'advance'});this.editor.switchToolbar(ToolbarContainerFull);this.curToolbarMode='advance';var btn=this.editor.getButton('_switchtoolbar','advance');btn.dom.innerHTML='基本功能<b></b>';}));this.editor.addCommand('_switchtoolbar',ve.bind(this,function(e,b){var tag=this.curToolbarMode=='advance'?'default':'advance';var tagText=this.curToolbarMode=='default'?'基本功能<b></b>':'高级功能<b></b>';this.editor.switchToolbar(tag);this.curToolbarMode=tag;var btn=this.editor.getButton('_switchtoolbar',tag);btn.dom.innerHTML=tagText;}));var btn=this.editor.addButton('switchtoolbar',{to:'group5',at:0,'class':'veToolbarSwitcher',title:'工具条模式切换',text:'高级功能<b></b>',cmd:'_switchtoolbar'});}});v.plugin.register('toolbarswitcher',ve.plugin.ToolbarSwitcher);v.Class('ve.plugin.XPaste',{editor:null,pop:null,iframeDoc:null,url:null,matchCleanPattern:false,init:function(editor,url){this.editor=editor;this.url=url;if(!ve.isChrome){this.editor.onInitComplete.add(ve.bind(this,this.autoDetectedPasteContent));}
this.editor.addCommand('showPasteContentPanel',ve.bind(this,function(e,b){this.showPanel(b);}));},autoDetectedPasteContent:function(){this.editor.onPaste.add(ve.bind(this,function(){this.editor.setContent('<!--rtxtstart-->');window.setTimeout(ve.bind(this,function(){this.editor.setContent('<\!\-\-rtxtend\-\->');var oriContent=this.editor.getContent();var reg=/<\!\-\-rtxtstart\-\->([\s\S]*)<\!\-\-rtxtend\-\->/g;var result=reg.exec(oriContent);if(result&&result[1]){var str=this.processContent(result[1]);var str2=oriContent.replace(reg,function(){return str;});this.editor.clearContent();this.editor.setContent(str2);this.editor.selection.moveToBookmark(this.editor.bookmark);}
this.showStatusTip();}),200);}));},showPanel:function(node,config){var region=dom.getRegion(node);var config=ve.extend(config||{},{left:region.left,top:region.top+region.height});if(!this.pop){var url=/^https?/.test(this.url)?this.url.replace(/\/\w+\.js$/,'/html/xpaste.html'):(new ve.util.Path().toAbs(this.url)+'/html/xpaste.html');var html=(['<div id="ed-paste-richtext"><strong>粘贴富文本</strong>','<div>','<div id="ed-paste-iframe"></div>','<input type="button" value="确定" id="paste-richtext-btn"/>','</div></div>']).join('');this.pop=ve.ui.showSimplePopup(this.editor,node,{content:html,height:210,width:350});this.setupEvent(this.pop.getDOM());var iframeHTML='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';iframeHTML+='<style type="text/css">html,body,p,ul,li,form{padding:0; margin:0;}body {background-color: transparent; width:100%}</style>';if(veEditor.domain){iframeHTML+='<script type="text/javascript">document.domain = "'+veEditor.domain+'";</script>';iframeHTML+='</head><body></body></html>';}
var iframe=document.createElement('iframe');iframe.style.border='none';iframe.frameborder='0';dom.get('ed-paste-iframe').appendChild(iframe);if(ve.isIE){if(document.readyState=='complete'&&iframe.readyState=='complete'){this.iframeDoc=iframe.contentWindow.document;this.iframeDoc.designMode='On';this.iframeDoc.contentEditable=true;this.iframeDoc.open();this.iframeDoc.write(iframeHTML);this.iframeDoc.close();iframe.contentWindow.focus();}}else{this.iframeDoc=iframe.contentWindow.document;this.iframeDoc.designMode='On';this.iframeDoc.contentEditable=true;this.iframeDoc.open();this.iframeDoc.write(iframeHTML);this.iframeDoc.close();iframe.contentWindow.focus();}}
this.pop.show();var toolbarContainerRegion=dom.getRegion(this.editor.toolbarContainer);var popRegion=dom.getRegion(this.pop.getDOM());if((config.left+popRegion.width)>(toolbarContainerRegion.left+toolbarContainerRegion.width)){config.left=toolbarContainerRegion.left+toolbarContainerRegion.width-popRegion.width;}
this.pop.show(config);},setupEvent:function(popContainer){dom.event.add($('txt-paste-richtext'),'focus',function(){this.select();});dom.event.add($('paste-richtext-btn'),'click',ve.bind(this,function(){var val=this.iframeDoc.body.innerHTML;if(val.trim()==''){alert('请输入内容');}else{var result=this.processContent(val);if(result){this.editor.setContent(result);this.showStatusTip();}else{alert('清理失败');}}
this.iframeDoc.body.innerHTML='';this.closePanel();}));},showStatusTip:function(){if(this.matchCleanPattern){this.editor.showStatusbar('当前粘贴的内容已经经过过滤处理，如果与您实际的内容不符合，请手动编辑');setTimeout(ve.bind(this,function(){this.editor.hideStatusbar();}),3000);}},closePanel:function(){this.node=null;if(this.pop){this.pop.hide();}},processContent:function(str){var _this=this;_this.matchCleanPattern=false;var process=function(items){each(items,function(v){try{if(v.constructor==RegExp){str=str.replace(v,function(str){if(str){_this.matchCleanPattern=true;}
return'';});}else{str=str.replace(v[0],function(str){if(str){_this.matchCleanPattern=true;}
return v[1];});}}catch(e){}});};process([/[\r\n]/gi,/^\s*(&nbsp;)+/g,/(&nbsp;|<br[^>]*>)+\s*$/g,[/<!--\[if !supportLists\]-->/gi,'$&__VE_ITEM__'],[/(<span[^>]+:\s*symbol[^>]+>)/gi,'$1__VE_ITEM__'],[/(<span[^>]+mso-list:[^>]+>)/gi,'$1__VE_ITEM__'],/<!--[\s\S]+?-->/gi,/<\\?\?xml[^>]*>/gi,/<\/?o:[^>]*>/gi,/ (id|name|language|type|on\w+|v:\w+)=\"([^\"]*)\"/gi,/ (id|name|language|type|on\w+|v:\w+)=(\w+)/gi,[/<(\/?)s>/gi,'<$1strike>'],/<script[^>]+>[\s\S]*?<\/script>/gi,[/&nbsp;/g,'\u00a0'],/<\/?(span)[^>]*>/gi,/ class=\"([^\"]*)\"/gi,/ class=(\w+)/gi,/ class=\"(mso[^\"]*)\"/gi,/ class=(mso\w+)/gi,/<\/?(span)[^>]*>/gi,[/<([\w]+\:[^ ]+)[^>]*>([^<]*)<\/?\1>/gi,'$2'],/<img[^>]+src=\"file:\/\/\/.*?>/gi,/<style[^>].*?<\/style>/gi]);return str;}});v.plugin.register('xpaste',ve.plugin.XPaste);v.Class('ve.plugin.HtmlEditor',{editor:null,button:null,editorState:0,copyState:false,config:{className:'veHtmlEditor'},init:function(editor,url){this.editor=editor;this.editor.addCommand('toggleHtmlEditor',ve.bind(this,function(ed,button){this.toggleHtmlEditor();}));this.editor.addButton('toggleHtmlEditorBtn',{to:'group5',at:1,'class':'veHtml',title:'切换到HTML代码模式',cmd:'toggleHtmlEditor'});},toggleHtmlEditor:function(){if(!this.editor.htmlElement){this.createHtmlContainer();}
this.editorState=this.editorState?0:1;this.editor.iframeElement.style.display=this.editorState?'none':'';this.editor.htmlElement.style.display=this.editorState?'':'none';this.setOtherToolbarButtonsState(!this.editorState);if(this.editorState){this.editor.htmlElement.value=this.editor.getContent();}else{this.editor.clearContent();this.editor.setContent({content:this.editor.htmlElement.value,useParser:true});}},setOtherToolbarButtonsState:function(enabled){},createHtmlContainer:function(){var ta=v.createElement
this.editor.htmlElement=dom.create('textarea',{allowtransparency:'true',allowTransparency:'true',style:{width:'100%',height:'100%',border:'1px solid gray'}},null,this.editor.iframeContainer);this.editor.htmlElement.className=this.config.className;dom.event.add(this.editor.htmlElement,'keydown',ve.bind(this,function(){if(!this.copyState){this.copyState=true;setTimeout(ve.bind(this,function(){this.editor.clearContent();this.editor.setContent({content:this.editor.htmlElement.value,useParser:true});this.copyState=false;}),500);}}));return this.editor.htmlElement;}});v.plugin.register('htmleditor',ve.plugin.HtmlEditor);})(ve);var createRegEX=function(pattern,flags){try{var reg=new RegExp('');reg.compile(pattern,flags);return reg;}catch(e){console.log(e,pattern,flags);}};(function(v){v.Class('ve.plugin.QzoneMedia',{defaultHtmlToUBBRegEx:{toStrong:createRegEX('<([\\/]?)(strong|b)[^>]*>','ig'),toItalic:createRegEX('<([\\/]?)(em|i)[^>]*>','ig'),toUnderline:createRegEX('<([\\/]?)(ins|u)[^>]*>','ig'),toAlignCenter:createRegEX('<(div|p)[^>]+align.{0,2}center[^>]*>([^\\<]+)<\\/(div|p)[^>]*>','ig'),toAlignRight:createRegEX('<(div|p)[^>]+align.{0,2}right[^>]*>([^\\<]+)<\\/(div|p)[^>]*>','ig'),glowFont:createRegEX('<font[^>]+\\_glowcolor.{0,2}#(\\w{6})[^>]*>','ig'),removeDumpDiv:createRegEX('^<(div|p)></(div|p)>','i'),toNameCard:createRegEX('<a[^>]+link="nameCard_(\\d+)"[^>]*>(.*?)<\\/a[^>]*>','ig'),toMail:createRegEX('<a[^>]+href="mailto:(.*?)"[^>]*>(.*?)<\\/a[^>]*>','ig'),toUrl:createRegEX('<a[^>]+href="(.*?)"[^>]*>(.*?)<\\/a[^>]*>','ig'),toEmotion:createRegEX('<img[^>]+em\\/e(\\d{1,3}).gif[^>]*>','ig'),fullFont:createRegEX('<font[^>]+style="[^"].+color=#(\\w+).+color:\s#(\\w+).+"[^>]*>([^\\<]+)<\\/font[^>]*>','ig'),delScript:createRegEX('<script[^>]*>(.*?)<\\/script[^>]*>','ig'),blockLine:createRegEX('<(div|p)[^>]*>(.*?)(<b(r|r\\/)>|)<\\/(div|p)[^>]*>','ig'),block:createRegEX('<b(r|r\\/)>','ig'),paragraph:createRegEX('<p[^>]*>(.*?)<\/p>','ig'),paragraph2:'hello',orderedListStart:createRegEX('<ol(\\s*style="LIST-STYLE-TYPE:\\s*[a-z]+(;)?")?[^>]*>','ig'),orderedListEnd:createRegEX('<\\/ol>','ig'),unorderedListStart:createRegEX('<ul(\\s*style="LIST-STYLE-TYPE:\\s*[a-z]+(;)?")?[^>]*>','ig'),unorderedListEnd:createRegEX('<\\/ul>','ig'),listItemStart:createRegEX('<li(\\s*style="MARGIN:\\s*\\d+px(;)?")?[^>]*>','ig'),listItemEnd:createRegEX('<\\/li>','ig')},defaultUBBToHtmlRegEX:{ubbNameCard:createRegEX('\\[card=(\\d+)\\](.+?)\\[\\/card\\]','ig'),ubbURL:createRegEX('\\[url=(http[^\\]\\"\\\']+)]([^\\[]+)\\[\\/url\\]','ig'),ubbGlow:createRegEX('\\[ffg,([#\\w]{1,10}),([#\\w]{1,10})\\]','ig'),ubbFont:createRegEX('\\[ft=([^\\]]+)\\]','ig'),ubbFontColor:createRegEX('\\[ftc=([#\\w]{1,10})\\]','ig'),ubbFontSize:createRegEX('\\[fts=([1-6]{1,1})\\]','ig'),ubbFontFace:createRegEX('\\[ftf=(.[^\\]]+)\\]','ig'),ubbVphoto:createRegEX('\\[vphoto,(\\d+),(\\d{5,11})](.*?)\\[\\/vphoto\\]','ig')},setConfig:function(key,val){this.config[key]=val;return this;},getConfig:function(key){return key?this.config[key]:this.config;},showPanel:function(){var panelConfig=this.getConfig('panel');var dlg=QZONE.FP.popupDialog(panelConfig.name,{src:panelConfig.url},panelConfig.width,panelConfig.height);if(this.popupCallback){QZFL.FP.appendPopupFn(ve.bind(this,this.popupCallback));}
dom.event.cancel(e);return dlg;},init:function(editor,url){this.editor=editor;this.bindInsertUBBMethod();this.setGetUBBContentParser(ve.bind(this,function(html){return this.defaultGetUBBContentParser(html);}));this.bindGetUBBContentMethod();this.bindSetContentEvent();this.bindGetContentEvent();},closePanel:function(){window.setTimeout(function(){try{QZONE.FP.closePopup();}catch(e){};},100)},setGetUBBContentParser:function(fun){if(!this.editor.GetUBBContentParserList){this.editor.GetUBBContentParserList=[];}
this.editor.GetUBBContentParserList.push(fun);},defaultGetUBBContentParser:function(str){str=str.replace(/(\n|\r)/g,'');str=str.replace(this.defaultHtmlToUBBRegEx.removeDumpDiv,'');str=str.replace(this.defaultHtmlToUBBRegEx.toEmotion,"[em]e$1[/em]");str=str.replace(/<img([^>]+)>/ig,function(){try{var args=arguments;var orgSrc=/orgSrc="([^"]+)"/i.exec(args[1]);var src=(orgSrc&&orgSrc[1])?orgSrc[1]:(/src="([^"]+)"/i.exec(args[1])[1]);var w=/WIDTH([\D]{0,2})(\d{1,4})/i.exec(args[1]);var h=/HEIGHT([\D]{0,2})(\d{1,4})/i.exec(args[1]);var t=/TRANSIMG=(\"*)(\d{1})/i.exec(args[1]);var ow=/ORIGINWIDTH=(\"*)(\d{1,4})/i.exec(args[1]);var oh=/ORIGINHEIGHT=(\"*)(\d{1,4})/i.exec(args[1]);var oContent=/CONTENT="([^"]+)"/i.exec(args[1]);var osrc=/ORIGINSRC="([^"]+)"/i.exec(args[1]);var c=(QZFL.userAgent.ie?/class=(flash|video|audio|qqVideo|vphoto|music)/i.exec(args[1]):/class="(flash|video|audio|qqVideo|vphoto)/i.exec(args[1]));var em=/em\/e(\d{1,3}).gif/i.exec(args[1]);if(em){return"[em]e"+em[1]+"[/em]";}
if(w&&h){return"[img,"+w[2]+","+h[2]+"]"+src+"[/img]";}
return"[img]"+src+"[/img]";}catch(e){return''}});str=str.replace(this.defaultHtmlToUBBRegEx.toAlignCenter,"[M]$2[/M]");str=str.replace(this.defaultHtmlToUBBRegEx.toAlignRight,"[R]$2[/R]");str=str.replace(this.defaultHtmlToUBBRegEx.glowFont,"[ffg,#$1,#FFFFFF]");str=str.replace(/<font([^>]+)>/ig,function(){var args=arguments;var color=/color([^#\w]{0,2})([#\w]{1,7})/.exec(args[1]);var size=/size=["]?(\d{1})/.exec(args[1]);var face=/face=("|)([^"\s]+)("|)/.exec(args[1]);return"[ft="+(color?color[2]:'')+","+(size?size[1]:'')+","+(face?face[2]:'')+"]";});str=str.replace(/<\/font[^>]*>/ig,"[/ft]");if(!QZFL.userAgent.ie){str=str.replace(/<(div|span)([^>]+)>(.*?)<\/(div|span)[^>]*>/ig,function(all,a,b,c,d){var color=/color:\x20*?([^;]+)/.exec(b);var face=/font-family:\x20*?([^;]+)/.exec(b);var tmp;if(color&&color[1]){color=color[1].toLowerCase();if(color.indexOf("rgb")>-1){tmp=color.replace(/[rgb\(\)]/g,'').split(",");if(tmp&&tmp.length>2){color="#"+(tmp[0]-0).toString(16)+(tmp[1]-0).toString(16)+(tmp[2]-0).toString(16);}}}
else{color='';}
return"[ft="+color+",,"+(face?face[1]:'')+"]"+c+"[/ft]";});}
str=str.replace(this.defaultHtmlToUBBRegEx.blockLine,"$2\n");str=str.replace(this.defaultHtmlToUBBRegEx.block,"\n");str=str.replace(this.defaultHtmlToUBBRegEx.paragraph,"$1\n");str=str.replace(this.defaultHtmlToUBBRegEx.toStrong,"[$1B]");str=str.replace(this.defaultHtmlToUBBRegEx.toItalic,"[$1I]");str=str.replace(this.defaultHtmlToUBBRegEx.toUnderline,"[$1U]");str=str.replace(this.defaultHtmlToUBBRegEx.delScript,'');str=str.replace(this.defaultHtmlToUBBRegEx.toNameCard,"[card=$1]$2[/card]");str=str.replace(this.defaultHtmlToUBBRegEx.toMail,"[email=$2]$1[/email]");str=str.replace(this.defaultHtmlToUBBRegEx.toUrl,"[url=$1]$2[/url]");str=str.replace(this.defaultHtmlToUBBRegEx.orderedListStart,"[ol]");str=str.replace(this.defaultHtmlToUBBRegEx.orderedListEnd,"[/ol]");str=str.replace(this.defaultHtmlToUBBRegEx.unorderedListStart,"[ul]");str=str.replace(this.defaultHtmlToUBBRegEx.unorderedListEnd,"[/ul]");str=str.replace(this.defaultHtmlToUBBRegEx.listItemStart,"[li]");str=str.replace(this.defaultHtmlToUBBRegEx.listItemEnd,"[/li]");str=str.replace(/<[^>]*?>/g,'');str=str.replace(/&shy;/ig,'');str=str.replace(/&nbsp;/ig," ");str=str.replace(/&lt;/ig,"<");str=str.replace(/&gt;/ig,">");str=str.replace(/&amp;/ig,"&");str=str.replace(/\n$/i,'');str=str.replace(/\[(url|ft|b|i|u|email|ffg)[^\[]*?\](\x20*?)\[\/(url|ft|b|i|u|email)\]/,'');return str;},bindGetUBBContentMethod:function(){if(!this.editor.getUBBContent){this.editor.getUBBContent=ve.bind(this,function(html){if(!this.editor.GetUBBContentParserList){return html;}
var htmlContent=html||this.editor.getContent(),ubbContent=htmlContent;for(var i=this.editor.GetUBBContentParserList.length-1;i>=0;i--){var ubbParser=this.editor.GetUBBContentParserList[i];ubbContent=ubbParser(ubbContent);}
return ubbContent;});}},defaultInsertUBBParser:function(str){str=str.replace(/&/ig,"&amp;");str=str.replace(/  /ig,"&nbsp;&nbsp;");str=str.replace(/</ig,"&lt;");str=str.replace(/>/ig,"&gt;");str=str.replace(/(\n|\r)/g,"<br/>");str=str.replace(this.defaultUBBToHtmlRegEX.ubbNameCard,'<a href="http://user.qzone.qq.com/$1" link="nameCard_$1" target="_blank" class="q_namecard">$2</a>');str=str.replace(/\[url(|=([^\]]+))\]\[\/url\]/g,function(){var args=arguments;var href='';var REG_HTTP=/^http:\/\/anchor/i;if(REG_HTTP.test(args[2])){href=args[2];}else if(REG_HTTP.test(args[3])){href=args[3];}
if(!href){return args[0];}
return'<a href="'+href+'">#</a>';});str=str.replace(/\[url(|=([^\]]+))\](.+?)\[\/url\]/g,function(){var args=arguments;var REG_HTTP=/^http:\/\//i;var INVALID_HREF_STRING=/[\"\']/i;var INVALID_EXPLAIN_STRING=/\[(em|video|flash|audio|vphoto|quote|ffg|url|marque|email)/i;var explain='';var href='';if(!args[1]){if(REG_HTTP.test(args[3])){explain=href=args[3];}}else{if(REG_HTTP.test(args[2])){explain=args[3];href=args[2];}else if(REG_HTTP.test(args[3])){explain=args[2];href=args[3];}}
if(!href||!explain||INVALID_HREF_STRING.test(href)||INVALID_EXPLAIN_STRING.test(explain)){return args[0];}else{return'<a href="'+href+'" target="_blank">'+explain+'</a>';}});var fontCount=0;var a;if(a=str.match(this.defaultUBBToHtmlRegEX.ubbGlow)){fontCount+=a.length;str=str.replace(this.defaultUBBToHtmlRegEX.ubbGlow,'<font style="line-height:'+LINE_HEIGHT+'" class="lightFont" title="发光字" _glowColor="$1" color="$1">');}
if(a=str.match(this.defaultUBBToHtmlRegEX.ubbFont)){fontCount+=a.length;str=str.replace(this.defaultUBBToHtmlRegEX.ubbFont,function(){var s=arguments[1].split(",");var color=s[0]?' color='+s[0]:'';var size=s[1]?' size='+(s[1]>6?6:s[1]):'';var face=s[2]?' face='+s[2]:'';return'<font style="line-height:'+LINE_HEIGHT+'" '+color+size+face+'>';});}
if(a=str.match(this.defaultUBBToHtmlRegEX.ubbFontColor)){fontCount+=a.length;str=str.replace(this.defaultUBBToHtmlRegEX.ubbFontColor,'<font color="$1" style="line-height:'+LINE_HEIGHT+'">');}
if(a=str.match(this.defaultUBBToHtmlRegEX.ubbFontSize)){fontCount+=a.length;str=str.replace(this.defaultUBBToHtmlRegEX.ubbFontSize,'<font size="$1" style="line-height:'+LINE_HEIGHT+'">');}
if(a=str.match(this.defaultUBBToHtmlRegEX.ubbFontFace)){fontCount+=a.length;str=str.replace(this.defaultUBBToHtmlRegEX.ubbFontFace,'<font face="$1" style="line-height:'+LINE_HEIGHT+'">');}
var regstr=/\[\/ft\]/g;if(a=str.match(regstr)){fontCount-=a.length;str=str.replace(regstr,"</font>");}
if(fontCount>0){str+=(new Array(fontCount+1)).join("</font>");}
str=str.replace(/\[ol\]/ig,'<ol style="list-style-type:decimal">').replace(/\[\/ol\]/ig,"</ol>").replace(/\[ul\]/ig,'<ul style="list-style-type:disc">').replace(/\[\/ul\]/ig,"</ul>").replace(/\[li\]/ig,'<li>').replace(/\[\/li\]/ig,"</li>");var regstr=new RegExp("\\[email\\](.*?)\\[\\/email\\]","ig");str=str.replace(regstr,'<a href="mailto:$1" target="_blank">$1</a>');var regstr=new RegExp("\\[email=(.*?)\\](.*?)\\[\\/email\\]","ig");str=str.replace(regstr,'<a href="mailto:$2" target="_blank">$1</a>');str=str.replace(/\[B\](.*?)\[\/B\]/ig,'<B>$1</B>');str=str.replace(/\[U\](.*?)\[\/U\]/ig,'<U>$1</U>');str=str.replace(/\[I\](.*?)\[\/I\]/ig,'<I>$1</I>');str=str.replace(/\[M\]/ig,'<p align=center>&shy;');str=str.replace(/\[\/M\]/ig,"</p>");str=str.replace(/\[R\]/ig,'<p align=right>&shy;');str=str.replace(/\[\/R\]/ig,"</p>");return str;},setInsertUBBParser:function(fun){if(!this.editor.InsertUBBParserList){this.editor.InsertUBBParserList=[this.defaultInsertUBBParser];}
this.editor.InsertUBBParserList.push(fun);},setSetContentFilter:function(fun){if(!this.editor.SetContentFilterList){this.editor.SetContentFilterList=[];}
this.editor.SetContentFilterList.push(fun);},setGetContentFilter:function(fun){if(!this.editor.GetContentFilterList){this.editor.GetContentFilterList=[];}
this.editor.GetContentFilterList.push(fun);},bindInsertUBBMethod:function(){if(!this.editor.insertUBB){this.editor.insertUBB=ve.bind(this,function(ubb){var html=ubb;if(this.editor.InsertUBBParserList){for(var i=0;i<this.editor.InsertUBBParserList.length;i++){var htmlParser=this.editor.InsertUBBParserList[i];html=htmlParser.call(this,html);}}
this.editor.setContent(html);});}},bindSetContentEvent:function(){this.editor.onSetContent.add(ve.bind(this,function(data){var html=data;if(this.editor.SetContentFilterList){for(var i=0;i<this.editor.SetContentFilterList.length;i++){var fn=this.editor.SetContentFilterList[i];html=fn(html);}}
return html;}));},bindGetContentEvent:function(){this.editor.onGetContent.add(ve.bind(this,function(data){var html=data;if(this.editor.GetContentFilterList){for(var i=0;i<this.editor.GetContentFilterList.length;i++){var fn=this.editor.GetContentFilterList[i];html=fn(html);}}
return html;}));},isInWhiteList:function(url){var isQQVideo=/^http:\/\/((\w+\.|)(video|v|tv)).qq.com/i.test(url);var isImgCache=/^http:\/\/(?:cnc.|edu.|ctc.)?imgcache.qq.com/i.test(url)||/^http:\/\/(?:cm.|cn.|os.|cnc.|edu.)?qzs.qq.com/i.test(url);var isComic=/^http:\/\/comic.qq.com/i.test(url);return(isQQVideo||isImgCache||isComic);},escData:function(str){var rEscHTML=/[&<>\x27\x22]/g,hEscHTML={'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#039;','"':'&quot;'};return(str+'').replace(rEscHTML,function(c){return hEscHTML[c];});},restData:function(str){if(!ve.plugin.QzoneMedia.__utilDiv){ve.plugin.QzoneMedia.__utilDiv=document.createElement("div");}
var t=ve.plugin.QzoneMedia.__utilDiv;t.innerHTML=(str+'');if(typeof(t.innerText)!='undefined'){return t.innerText;}else if(typeof(t.textContent)!='undefined'){return t.textContent;}else if(typeof(t.text)!='undefined'){return t.text;}else{return'';}},insertHtml:function(html){this.editor.setContent(html);},setCache:function(data){if(!window.qzonemedia_cache_id_count){window.qzonemedia_cache_id_count=1000;window.qzonemedia_cache_data={};}
window.qzonemedia_cache_id_count+=1;window.qzonemedia_cache_data[window.qzonemedia_cache_id_count]=data;return window.qzonemedia_cache_id_count;},getCache:function(id){return window.qzonemedia_cache_data[id]||null;}});v.plugin.register('qzonemedia',ve.plugin.QzoneMedia);})(ve);(function(v){v.Class('ve.plugin.Emotion:ve.plugin.QzoneMedia',{bEmotionLoaded:false,btnElement:null,editor:null,jsPath:'http://image.soso.com/js/sosoexp_platform.js',init:function(editor,url){this.editor=editor;this.editor.addCommand('showEmotionPanel',ve.bind(this,function(ed,btn){this.btnElement=btn;this.show();QZFL.event.preventDefault();return false;}));this.editor.addButton('showEmotionPanel',{to:'group4',at:2,'class':'veEmotion',title:'表情',cmd:'showEmotionPanel'});this.editor.onClick.add(ve.bind(this,function(){this.hide()}));this.setInsertUBBParser(ve.bind(this,function(ubb){return this.onInsertUBB(ubb);}));},show:function(){var _this=this;if(typeof SOSO_EXP!=="object"){QZFL.imports(this.jsPath,function(){if(typeof SOSO_EXP==="object"){SOSO_EXP.Register(30001,'qzone',_this.btnElement,'bottom',_this.editor,function(a,b){b=b.replace(/^http:\/\/cache.soso.com\/img\/img\/e(\d{1,3}).gif/gi,"/qzone/em/e$1.gif");a.setContent('<img src="'+b+'"/>');});_this.btnElement.setAttribute('binded','1');SOSO_EXP.Platform.popupBox(_this.btnElement);}});}
else if(!_this.btnElement.getAttribute('binded')){SOSO_EXP.Register(30001,'qzone',_this.btnElement,'bottom',_this.editor,function(a,b){b=b.replace(/^http:\/\/cache.soso.com\/img\/img\/e(\d{1,3}).gif/gi,"/qzone/em/e$1.gif");var r=a.setContent('<img src="'+b+'"/>');});SOSO_EXP.Platform.popupBox(_this.btnElement);}},hide:function(){if(typeof(SOSO_EXP)=='object'){SOSO_EXP.Platform.hideBox();}},onInsertUBB:function(str){try{var reg=createRegEX('\\[em\\]e(\\d{1,3})\\[\\/em\\]','ig');str=str.replace(reg,'<img src="/qzone/em/e$1.gif" onresizestart="return false;">');return str;}catch(e){console.log('UBB emotion log error');return str;}}});v.plugin.register('emotion',ve.plugin.Emotion);})(ve);(function(v){v.Class('ve.plugin.ImageTools',{toolbar:null,editor:null,_lastImg:null,_lastAttr:null,init:function(editor,url){this.editor=editor;this.editor.onMouseDown.add(ve.bind(this,function(e){var img=QZFL.event.getTarget(e);if(img.tagName!='IMG'){this.hideTools();return;}
if(!this.checkImageEditAviable(img)){img.setAttribute("unselectable","on");img.style.MozUserSelect="none";img.style.MozUserFocus="ignore";img.blur();QZFL.event.preventDefault();return false;}else{this.editor.undoManager.add();this._lastImg=img;this._lastAtrr={width:img.width,height:img.height}
this.showTools(img);dom.event.add(img,'mouseup',ve.bind(this,function(){if(this._lastImg){if(this._lastImg.width!=this._lastAtrr.width||this._lastImg.height!=this._lastAtrr.height){this.editor.undoManager.add();}
dom.event.remove(this._lastImg,'mouseup',arguments.callee);this._lastImg=null;this._lastAtrr=null;}}));}}));this.editor.onKeyDown.add(ve.bind(this,function(e){if(e&&e.keyCode==46){this.hideTools();}}));},checkImageEditAviable:function(node){if(!node.tagName=='IMG'||/em\/e(\d{1,3}).gif/i.test(node.src)||/blog_music/i.test(node.className)){return false;}
return true;},disableScale:function(tag){if(!tag||tag.tagName!='IMG'){return;}},showTools:function(img){if(!this.toolbar){this.toolbar=QZFL.dom.createElementIn('div');this.toolbar.className='qzEditor_tips pic_tips';this.toolbar.innerHTML=(['<ul class="pic_function" id="qzEditor_tips_pic_function">','<li class="father_button pic_position"><a title="编辑图片位置" class="main_btn first" href="javascript:;"><span class="icon_sprite icon_pic_position"></span><em class="none">编辑图片位置</em></a>','<ol class="dropdown_functions">','<li><a href="javascript:;" id="_pic_func_align_reset"><span class="icon_sprite icon_pic_reset"></span><em class="text_intro">默认</em></a></li>','<li><a href="javascript:;" id="_pic_func_align_left"><span class="icon_sprite icon_pic_left"></span><em class="text_intro">居左</em></a></li>','<li><a href="javascript:;" id="_pic_func_align_center"><span class="icon_sprite icon_pic_center"></span><em class="text_intro">居中</em></a></li>','<li><a href="javascript:;" id="_pic_func_align_right"><span class="icon_sprite icon_pic_right"></span><em class="text_intro">居右</em></a></li>','<li><a href="javascript:;" id="_pic_func_align_round_left"><span class="icon_sprite icon_pic_left_round"></span><em class="text_intro">居左环绕</em></a></li>','<li><a href="javascript:;" id="_pic_func_align_round_right"><span class="icon_sprite icon_pic_right_round"></span><em class="text_intro">居右环绕</em></a></li>','</ol>','</li>','<li class="father_button pic_link "><a class="main_btn" title="插入图片链接地址" href="javascript:;"><span class="icon_sprite icon_pic_link"></span><span class="none">插入图片链接地址</span></a>','<div class="dropdown_functions pic_link_item "><strong class="title">链接地址:</strong><input type="text" class="url" id="_pic_func_link" value="http://" style="width:160px"/> <input type="button" value="确定" id="_pic_func_btn" /></div>','</li>','</ul>']).join('');var btns=dom.get('qzEditor_tips_pic_function').getElementsByTagName('A');for(var i=0;i<btns.length;i++){if(dom.hasClass(btns[i],'main_btn')){dom.event.add(btns[i].parentNode,'mouseover',function(){dom.addClass(this,'current');});dom.event.add(btns[i].parentNode,'mouseout',function(){dom.removeClass(this,'current')});}}}
var _this=this;dom.event.add(dom.get('_pic_func_align_reset'),'click',function(){_this.setImageAlign(img);});dom.event.add(dom.get('_pic_func_align_left'),'click',function(){_this.setImageAlign(img,'left');});dom.event.add(dom.get('_pic_func_align_center'),'click',function(){_this.setImageAlign(img,'center');});dom.event.add(dom.get('_pic_func_align_right'),'click',function(){_this.setImageAlign(img,'right');});dom.event.add(dom.get('_pic_func_align_round_left'),'click',function(){_this.setImageAlign(img,'roundLeft');});dom.event.add(dom.get('_pic_func_align_round_right'),'click',function(){_this.setImageAlign(img,'roundRight');});this.initLink(img);this.updateToolsPosition(img);},initLink:function(img){if(img.parentNode.tagName=='A'){dom.get('_pic_func_link').value=img.parentNode.href;}
dom.event.add(dom.get('_pic_func_link'),'keydown',ve.bind(this,function(e){var e=e||window.event;if(e.keyCode==13){this.setLink(img,dom.get('_pic_func_link').value);}}));dom.event.add(dom.get('_pic_func_btn'),'click',ve.bind(this,function(){this.setLink(img,dom.get('_pic_func_link').value);}));},setLink:function(img,link){this.editor.undoManager.add();if(link==''&&img.parentNode.tagName=='A'){_pn=img.parentNode;img.ownerDocument.body.appendChild(img);QZFL.dom.swapNode(img,_pn);_pn.parentNode.removeChild(_pn);}else if(img.parentNode.tagName=='A'){img.parentNode.href=link;}else{var a=img.ownerDocument.createElement('A');img.ownerDocument.body.appendChild(a);a.href=link;a.target='_blank';QZFL.dom.swapNode(img,a);a.appendChild(img);}},setImageAlign:function(img,align){var updateStyle={};switch(align){case'left':updateStyle={'marginRight':'auto','display':'block'};break;case'right':updateStyle={'marginLeft':'auto','display':'block'};break;case'center':updateStyle={'marginLeft':'auto','marginRight':'auto','display':'block'};break;case'roundLeft':updateStyle={'float':'left'};break;case'roundRight':updateStyle={'float':'right'};break;}
var clearStyle={'marginLeft':0,'marginRight':0,'float':'none','display':''};dom.setStyles(img,clearStyle);dom.setStyles(img,updateStyle);this.updateToolsPosition(img);this.editor.undoManager.add();QZFL.event.preventDefault();return false;},hideTools:function(){if(this.toolbar){this.toolbar.style.display='none';}},updateToolsPosition:function(img){var toolbarRegion=dom.getRegion(this.toolbar),iframeRegion=dom.getRegion(this.editor.iframeElement),imgRegion=dom.getRegion(img);var styles={display:'block',position:'absolute',top:iframeRegion.top+imgRegion.top,left:iframeRegion.left+imgRegion.left};for(var i in styles){dom.setStyle(this.toolbar,i,styles[i]);}}});v.plugin.register('imagetools',ve.plugin.ImageTools);})(ve);(function(v){v.Class('ve.plugin.QzoneFlash:ve.plugin.QzoneMedia',{editor:null,config:{baseURL:'http://'+IMGCACHE_DOMAIN+'/qzone/newblog/v5/editor/dialog/flash.html',panel:{url:null,name:'插入Flash动画',width:430,height:233},pUrl:'',pAlbumId:'',cssClassName:'blog_flash',disableScale:false},init:function(editor,url){this.editor=editor;this.config.panel.url=this.config.baseURL+'?editorid='+this.editor.editorId;this.editor.addCommand('showFlashPanel',ve.bind(this,function(){top.popupCallback=ve.bind(this,function(){var id=this.editor.editorId;if(top.g_arrQZEditorReturnVal&&top.g_arrQZEditorReturnVal[id]){var data=top.g_arrQZEditorReturnVal[id];var w=(data[3]?data[3]:"520");var h=(data[2]?data[2]:"425");var left=(data[4]?data[4]:null);var _top=(data[5]?data[5]:null);var cache_id=this.setCache(data);var style=_top?';position:absolute; top:'+_top+'px'+';left:'+left+'px;':'';html='<img src="/ac/b.gif" alt="flash" class="'+this.config.cssClassName+'" style="width:'+w+'px;height:'+h+'px;'+style+'" cache_id="'+cache_id+'" />';this.insertHtml(html);}
try{top.g_arrQZEditorReturnVal[id]=null;}catch(e){console.log(e);};this.closePanel();});this.showPanel();}));this.editor.addButton('VideoButton',{to:'group4',at:1,'class':'veInsertFlash',title:'插入Flash动画',cmd:'showFlashPanel'});this.setSetContentFilter(ve.bind(this,function(html){return this.onSetContent(html);}))
this.setGetUBBContentParser(ve.bind(this,function(html){return this.onGetUBBContent(html);}));this.setGetContentFilter(ve.bind(this,function(html){return this.onGetContent(html);}));this.setInsertUBBParser(ve.bind(this,function(ubb){return this.onInsertUBB(ubb);}));},onSetContent:function(str){var _this=this;str=str.replace(/<object([^>]+)>(.*?)<\/object>/ig,function(){try{if(/class=("|')*blog_(qqVideo|flash)/i.test(arguments[1])){var res=/(<embed([^>]+)>)/ig.exec(arguments[2]);if(!!res){return res[1];}}}catch(err){}
return arguments[0];});str=str.replace(/<embed([^>]+)>/ig,function(){try{if(/class=("|')*blog_(qqVideo|flash)/i.test(arguments[1])){var className=/class=("|')*blog_(qqVideo|flash)/i.exec(arguments[1]);var width=/width="([^"]+)"/i.exec(arguments[1])||[];var height=/height="([^"]+)"/i.exec(arguments[1])||[];var src=/src="([^"]+)"/i.exec(arguments[1])||[];var _top=/top\:([^px])/i.exec(arguments[1])||[];var left=/left:([^px])/i.exec(arguments[1])||[];var data=[src[1],'auto',width[1],height[1],'false',left[1],_top[1]];var absStyle=_top[1]?';position:absolute; top:'+_top[1]+'px'+';left:'+left[1]+'px;':'';var cache_id=_this.setCache(data);return'<img src="/ac/b.gif" class="blog_'+className[2]+'" style="width:'+(width[1]==0?400:width[1])+'px;height:'+(height[1]==0?300:height[1])+'px;'+absStyle+'" cache_id="'+cache_id+'" />';}}catch(err){console.log('error',err);}
return arguments[0];});return str;},onGetUBBContent:function(str){str=str.replace(/<object([^>]+)>(.*?)<\/object>/ig,function(){try{if(/class=("|')*blog_(qqVideo|flash)/i.test(arguments[1])){var res=/(<embed([^>]+)>)/ig.exec(arguments[2]);if(!!res){return res[1];}}}catch(err){}
return arguments[0];});str=str.replace(/<embed([^>]+)>/ig,function(){try{if(/class=("|')*blog_(qqVideo|flash)/i.test(arguments[1])){var className=/class=("|')*blog_(qqVideo|flash)/i.exec(arguments[1]);var width=/width="([^"]+)"/i.exec(arguments[1]);var height=/height="([^"]+)"/i.exec(arguments[1]);var src=/src="([^"]+)"/i.exec(arguments[1]);var _top=/top\:([^px])/i.exec(arguments[1]);var left=/left:([^px])/i.exec(arguments[1]);var data=[src,'auto',width,height,'false',left,_top];var absStyle=_top?';position:absolute; top:'+_top+'px'+';left:'+left+'px;':'';var ubbstr=(['[flasht,',(data[3]?data[3]:"520"),',',(data[2]?data[2]:'425'),(data[5]?data[5]+',':''),(data[6]?data[6]+',':''),']',data[0],'[/flasht]']).join('');return ubbstr;}}catch(err){console.log('onGetUBBContent err',err);}
return arguments[0];});return str;},onGetContent:function(str){str=str.replace(/<img([^>]+)>/ig,ve.bind(this,function(){try{if(/class=("|')*blog_(qqVideo|flash)/i.test(arguments[1])){var className=/class=("|')*blog_(qqVideo|flash)/i.exec(arguments[1]);var cache_id=/cache_id="([^"]+)"/i.exec(arguments[1]);data=this.getCache(cache_id[1]);var src=data&&data[0];if(src){var w=/WIDTH(:|=|: )(\d{1,3})/i.exec(arguments[1]);var h=/HEIGHT(:|=|: )(\d{1,3})/i.exec(arguments[1]);var flag=this.isInWhiteList(src);var isQQSound=/qzone\/flashmod\/ivrplayer\/ivrplayer.swf/i.test(src);var isQQVideo=/^http:\/\/((\w+\.|)(video|v|tv)).qq.com/i.test(src);var left=data[5];var _top=data[6];var style=left?' style="position:absolute;left:'+left+'px; top:'+_top+'px"':'';var html='<embed class="blog_'+className[2]+'" id="'+Math.random()+'" menu="false" invokeURLs="false" allowNetworking="'+(flag?'all':'internal')+'" allowFullScreen="'+
(flag?'true':'false')+'" allowscriptaccess="'+(flag?'always':'never')+'"'+((isQQSound&&flag)?(' flashvars="autoplay=1"'):'')+' wmode="transparent" src="'+src+'" '+(h?' height="'+h[2]+'"':'')+(w?' width="'+w[2]+'" ':'')+(!isQQVideo?style:'')+'/>';if(isQQVideo){return'<object class="blog_'+className[2]+'" id="'+Math.random()+'" codeBase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab#version=8,0,0,0" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" '+(w?' width="'+w[2]+'"':'')+(h?' height="'+h[2]+'"':'')+style+'>'+'<param name="movie" value="'+src+'" /><param name="wmode" value="transparent" /><param name="allowFullScreen" value="true" /><param name="allowScriptAccess" value="always" /><param name="allownetworking" value="all" />'+html+'</object>';}
return html;}}}catch(err){console.log('onGetContent ERR',err);}
return arguments[0];}));return str;},onInsertUBB:function(str,bAddFlag){var _this=this;var reg=createRegEX('\\[flasht(|,(\\d+),(\\d+)),(\\d+)),(\\d+))\\](.*?)\\[\\/flasht\\]','ig');var regIsQQVideo=createRegEX('http:\\/\\/((\\w+\\.|)(video|v|tv)).qq.com','i');str=str.replace(reg,function(){var w=(arguments[1]?arguments[1]:"520");var h=(arguments[2]?arguments[2]:"425");var left=(arguments[3]?arguments[3]:null);var _top=(arguments[4]?arguments[5]:null);var src=arguments[5];var data=[src,'auto',w,h,'false',left,_top];var cache_id=_this.setCache(data);var style=_top?';position:absolute; top:'+_top+'px'+';left:'+left+'px;':'';return'<img src="/ac/b.gif" class="blog_'+(regIsQQVideo.test(arguments[4])?"qqVideo":"flash")+'" style="'+style+' width:'+w+'px;height:'+h+'px;" cache_id="'+cache_id+'" />';});return str;}});v.plugin.register('qzoneflash',ve.plugin.QzoneFlash);})(ve);(function(v){v.Class('ve.plugin.QzoneImage:ve.plugin.QzoneMedia',{editor:null,lastBlogAlbumId:null,config:{baseURL:'http://'+IMGCACHE_DOMAIN+'/qzone/client/photo/pages/qzone_v4/insert_photo.html#referer=blog_editor',blogType:null,panel:{url:null,name:'插入图片',width:610,height:483},cssClassName:'',disableScale:false},init:function(editor,url){this.editor=editor;this.config.blogType=7;this.editor.addCommand('showImagePanel',ve.bind(this,function(){QZONE.FP._t.insertPhotoContent=null;this.config.panel.url=([this.config.baseURL,'&blog_type=',this.blogType,'&uin=',QZBlog.Util.getSpaceUin(),'&albumid=',this.lastBlogAlbumId]).join('');this.showPanel();}));this.editor.addButton('ImageButton',{to:'group4',at:1,'class':'veInsertImage',title:'插入图片',cmd:'showImagePanel'});this.setSetContentFilter(ve.bind(this,function(html){return this.onSetContent(html);}));this.setInsertUBBParser(ve.bind(this,function(ubb){return this.onInsertUBB(ubb);}));},popupCallback:function(){var data=QZONE.FP._t.insertPhotoContent,maxWidth=this.editor.getBody().offsetWidth-20;this.lastBlogAlbumId=data.lastAlbumId;if(data&&data.photos){for(var i=0;i<data.photos.length;i++){var p=data.photos[i],htmls=[],width=0,id='_qzone_image_plugin_id_pre_'+i+Math.random();if(p.width){width=p.width>maxWidth?maxWidth:width;}
htmls.push('<img src="',p.url,'" alt="图片" appendurl="1" id="',id,'" ',(width?'style="width:'+width+'px;"':''),'/><br/>');if(data.needAlbumName&&p.name){htmls.push('照片名称：'+p.name+'<br/>');}
if(data.needAlbumName&&p.albumName){htmls.push('所属相册：'+'<a href="'+p.albumUrl+'">'+p.albumName+'</a><br/>');}
if(data.needPhotoDesc&&p.desc){htmls.push('照片描述：'+p.desc+'<br/>');}
this.insertHtml(htmls.join(''));if(!width){this.bindImageResize(id,maxWidth);}else{this.editor.getDoc().getElementById(id).removeAttribute('id');}}}
this.closePanel();QZONE.FP._t.insertPhotoContent=null;},bindImageResize:function(id,maxWidth){var img=this.editor.getDoc().getElementById(id);var width=img.width||img.offsetWidth||img.clientWidth;if(width&&width>maxWidth){img.style.width=(maxWidth-20)+'px';}else{img.onload=function(){this.onload=null;if(this.width>maxWidth){this.width=maxWidth;}};}
img.removeAttribute('id');},onSetContent:function(str){var result;try{result=str.replace(/(<img[^>].*src=["|'])(.*?)(["|'].*orgsrc=["|'])(.*?)(["|'].*?>)/ig,"$1$4$3$5");result=result.replace(/orgsrc=["|'.*?["|']/ig,'');}catch(err){console.log('qzone image replace error');}
return result||str;},onInsertUBB:function(str){try{var reg=createRegEX('\\[img\\]http(.[^\\]\\\'\\"]*)\\[\\/img\\]','ig');str=str.replace(reg,function(){var strUrl=arguments[1];return'<img appendurl="1" src="http'+strUrl+'" alt="图片" />';});var reg=createRegEX('ubbResizeImg','\\[img,(\\d{1,4}),(\\d{1,4})\\]http(.[^\\]\\\'\\"]*)\\[\\/img\\]','ig');str=str.replace(reg,function(){var strUrl=arguments[3];var height=arguments[2];var width=arguments[1];return'<img'+(bAddFlag?' fromubb="1"':'')+' appendurl="1" src="http'+strUrl+'" border="0" width="'+width+'" height="'+height+'" alt="图片" />';});return str;}catch(e){console.log(e,'UBB image log error');return str;}}});v.plugin.register('qzoneimage',ve.plugin.QzoneImage);})(ve);(function(v){v.Class('ve.plugin.QzoneMusic:ve.plugin.QzoneMedia',{editor:null,config:{baseURL:'http://'+IMGCACHE_DOMAIN+'/music/musicbox_v2_1/doc/blog_add_song.html',panel:{url:null,name:'插入音乐',width:640,height:330},pUrl:'',pAlbumId:'',cssClassName1:'blog_music',cssClassName2:'blog_music_multiple',disableScale:true},init:function(editor,url){this.editor=editor;this.config.panel.url=this.config.baseURL+'?editorid='+this.editor.editorId;this.editor.addCommand('showMusicPanel',ve.bind(this,function(){top.popupCallback=ve.bind(this,function(){var id=this.editor.editorId;if(top.g_arrQZEditorReturnVal&&top.g_arrQZEditorReturnVal[id]){var data=top.g_arrQZEditorReturnVal[id];var arr=data.split("|");var cache_id=this.setCache(data);var html='<img src="/ac/b.gif" alt="音乐" cache_id="'+cache_id+'" class="'+(arr.length>7?this.config.cssClassName2:this.config.cssClassName1)+'" onresizestart="return false;"/>&nbsp;';this.insertHtml(html);}
try{top.g_arrQZEditorReturnVal[id]=null;}catch(e){};this.closePanel();});this.showPanel();}));this.editor.addButton('MusicButton',{to:'group4',at:1,'class':'veInsertMusic',title:'插入音乐',cmd:'showMusicPanel'});this.setSetContentFilter(ve.bind(this,function(html){return this.onSetContent(html);}));this.setGetUBBContentParser(ve.bind(this,function(html){return this.onGetUBBContent(html);}));this.setGetContentFilter(ve.bind(this,function(html){return this.onGetContent(html);}));this.setInsertUBBParser(ve.bind(this,function(ubb){return this.onInsertUBB(ubb);}));},onSetContent:function(html){try{str=html.replace(/<object([^>]+)>(.*?)<\/object>/ig,ve.bind(this,function(){try{if(/class=("|')*blog_music/i.test(arguments[1])){var data=/ ubb="([^"]+)"/i.exec(arguments[1]);var arr=data[1].split("|");var cache_id=this.setCache(data[1]);return'<img src="/ac/b.gif" alt="音乐" cache_id="'+cache_id+'" class="'+(arr.length>7?this.config.cssClassName2:this.config.cssClassName1)+'" onresizestart="return false;"/>';}}catch(err){console.log('qzonemusic onSetContent err ',err);}
return arguments[0];}));}catch(e){console.log('qzonemusic onSetContent err',e);}
return str||html;},onGetUBBContent:function(str){try{str=str.replace(/<object([^>]+)>(.*?)<\/object>/ig,function(){try{if(/class=("|')*blog_music/i.test(arguments[1])){var data=/ ubb="([^"]+)"/i.exec(arguments[1]);return"[music]"+data+"[/music]";}}catch(err){}
return arguments[0];});}catch(e){console.log('qzonemusic onGetUBBContent err',e);}
return str;},onInsertUBB:function(str,bAddFlag){var _this=this;var reg=createRegEX('\\[music\\](.*?)\\[\\/music\\]','ig')
str=str.replace(reg,function(){var arr=arguments[1].split("|");var isMultiple=(arr.length>7?true:false);var cache_id=this.setCache(arguments[1]);return'<img src="/ac/b.gif" alt="音乐" cache_id="'+cache_id+'" class="'+(arr.length>7?this.config.cssClassName2:this.config.cssClassName1)+'" onresizestart="return false;"/>';});var audioReg=createRegEX('\\[audio,(true|false),(true|false),(true|false)](.*?)\\[\\/audio\\]','ig');str=str.replace(audioReg,function(){var data=[arguments[4],arguments[1],arguments[2],arguments[3]];var cache_id=_this.setCache(data.join('|'));return'<img src="/ac/b.gif" class="blog_audio" cache_id="'+cache_id+'" />'});return str;},onGetContent:function(str){var count=0;str=str.replace(/<img([^>]+)>/ig,ve.bind(this,function(){try{if(/class=("|')*blog_music/i.test(arguments[1])){var cache_id=/cache_id="([^"]+)"/i.exec(arguments[1]);var data=this.getCache(cache_id[1]);++count;var arr=data.split("|");return'<object codeBase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab#version=8,0,0,0" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+((arr.length>7)?440:410)+'" height="'+((arr.length>7)?190:100)+'" src="'+"http://"+IMGCACHE_DOMAIN+"/music/musicbox_v2_1/img/MusicFlash.swf"+'" bgcolor="#ffffff" scale="showall" menu="true" allowScriptAccess="always" name="musicFlash**" id="'+"musicFlash"+(count-1)+'" ubb="'+data+'" class="blog_music"><param name="movie" value="http://'+IMGCACHE_DOMAIN+'/music/musicbox_v2_1/img/MusicFlash.swf" />'+'<param name="bgColor" value="#ffffff" /><param name="scale" value="showall" /><param name="wmode" value="transparent" /><param name="menu" value="true" />'+'<param name="allowScriptAccess" value="always" /></object>';}}catch(err){console.log('qzone music ongetContent error',err);}
return arguments[0];}));return str;}});v.plugin.register('qzonemusic',ve.plugin.QzoneMusic);})(ve);(function(v){v.Class('ve.plugin.QzoneQQShowBubble:ve.plugin.QzoneMedia',{editor:null,config:{baseURL:'http://ptlogin2.qq.com/showbub?uin='+QZONE.cookie.get('zzpaneluin')+'&clientkey='+QZONE.cookie.get('zzpanelkey'),panel:{url:null,name:'插入QQ秀泡泡',width:900,height:505},pUrl:'',pAlbumId:'',cssClassName:'',disableScale:true,cacheKeyPre:'image_'},init:function(editor,url){this.editor=editor;this.editor.addCommand('showQQShowBubblePanel',ve.bind(this,function(){this.config.panel.url=this.config.baseURL+(!!this.config.pUrl?('&url='+this.config.pUrl.URLencode()):'')+(!!this.config.pAlbumId?("&albid="+this.config.pAlbumId):'');parent._tempQFCallback=ve.bind(this,function(url,width,height,sContent){var html='<img src="'+url+'" transimg="1" alt="'+sContent+'" style="height:'+height+'px; width:'+width+'px"/>'
this.insertHtml(html);this.closePanel();})
this.showPanel();}));this.editor.addButton('QQShowBubbleButton',{to:'group4',at:1,'class':'veInsertQQShowBubble',title:'插入QQ秀泡泡',cmd:'showQQShowBubblePanel'});this.setInsertUBBParser(this.onInsertUBB);},onInsertUBB:function(str,bAddFlag){var regEx=createRegEX('\\[qqshow,(\\d{1,3}),(\\d{1,3}),(\\d{1,3}),(\\d{1,3})(,(.*?)|)\\]http(.[^\\]\\\'\\"]*)\\[\\/qqshow\\]','ig');str=str.replace(regEx,'<img content="$6" style="width:$1 px;height:$2 px;" src="http$7" />');return str;}});v.plugin.register('qzoneqqshowbubble',ve.plugin.QzoneQQShowBubble);})(ve);(function(v){v.Class('ve.plugin.QzoneVideo:ve.plugin.QzoneMedia',{editor:null,config:{baseURL:'http://'+IMGCACHE_DOMAIN+'/qzone/mall/v5/video/index.html',panel:{url:null,name:'插入视频',width:526,height:450},cssClassName:'blog_video',disableScale:false,defaultVideoWidth:500,defaultVideoHeight:425},init:function(editor,url){this.editor=editor;this.config.panel.url=this.config.baseURL+'?editorid='+this.editor.editorId;this.editor.addCommand('showVideoPanel',ve.bind(this,function(){top.popupCallback=ve.bind(this,function(){var id=this.editor.editorId;if(top.g_arrQZEditorReturnVal&&top.g_arrQZEditorReturnVal[id]){var cache_id=this.setCache(top.g_arrQZEditorReturnVal[id]);var w=top.g_arrQZEditorReturnVal[id][4]||this.config.defaultVideoWidth;var h=top.g_arrQZEditorReturnVal[id][3]||this.config.defaultVideoHeight;var html=(['<img src="/ac/b.gif" alt="视频" cache_id="',cache_id,'" class="',this.config.cssClassName,'" style="width:',w,'px; height:',h,'px"/>']).join('');this.insertHtml(html);}
try{top.g_arrQZEditorReturnVal[id]=null;}catch(e){};this.closePanel();});this.showPanel();}));this.editor.addButton('VideoButton',{to:'group4',at:1,'class':'veInsertVideo',title:'插入视频',cmd:'showVideoPanel'});this.setSetContentFilter(ve.bind(this,function(html){return this.onSetContent(html);}));this.setGetUBBContentParser(ve.bind(this,function(html){return this.onGetUBBContent(html);}));this.setGetContentFilter(ve.bind(this,function(html){return this.onGetContent(html);}));this.setInsertUBBParser(ve.bind(this,function(ubb){return this.onInsertUBB(ubb);}));},onSetContent:function(str){str=str.replace(/<object([^>]+)>(.*?)<\/object>/ig,ve.bind(this,function(){try{if(/class=("|')*blog_video/i.test(arguments[1])){var res=/(<embed([^>]+)>)/ig.exec(arguments[2]);if(!!res){return res[1];}}}catch(err){console.log('err',err);}
return arguments[0];}));str=str.replace(/<embed([^>]+)>/ig,ve.bind(this,function(){try{if(/class=("|')*blog_video/i.test(arguments[1])){var w=/width="([^"]+)"/i.exec(arguments[1])||[];var h=/height="([^"]+)"/i.exec(arguments[1])||[];var loop=/loop="([^"]+)"/i.exec(arguments[1])||[];var autostart=/autostart="([^"]+)"/i.exec(arguments[1])||[];var autoplay=/autoplay="([^"]+)"/i.exec(arguments[1])||[];var src=/src="([^"]+)"/i.exec(arguments[1]);var count=0;var data=[count,src[1],loop[1],(w[1]||this.config.defaultVideoWidth),(h[1]||this.config.defaultVideoHeight),autostart[1],autoplay[1]];var cache_id=this.setCache(data);return(['<img src="/ac/b.gif" class="blog_video" style="width:',(w[1]||this.config.defaultVideoWidth),'px;height:',(h[1]||this.config.defaultVideoHeight),'px;" cache_id="',cache_id,'" />']).join('');}}catch(err){console.log('set content err',err);}
return arguments[0];}));return str;},onGetUBBContent:function(str){str=str.replace(/<embed([^>]+)>/ig,ve.bind(this,function(){try{if(/class=("|')*blog_video/i.test(arguments[1])){var w=/width="([^"]+)"/i.exec(arguments[1])||[];var h=/height="([^"]+)"/i.exec(arguments[1])||[];var loop=/loop="([^"]+)"/i.exec(arguments[1])||[];var autostart=/autostart="([^"]+)"/i.exec(arguments[1]);var src=/src="([^"]+)"/i.exec(arguments[1]);var data=[src[1],loop[1],autostart[1]];return"[video,"+(w[1]||this.config.defaultVideoWidth)+","+(h[1]||this.config.defaultVideoHeight)+","+data[1]+","+data[2]+"]"+data[0]+"[/video]";}}catch(err){console.log('qzonevideo onGetUBBContent err',e);}
return arguments[0];}));return str;},onGetContent:function(html){str=html.replace(/<img([^>]+)>/ig,ve.bind(this,ve.bind(this,function(){try{if(/class=("|')*blog_video/i.test(arguments[1])){var cache_id=/cache_id="([^"]+)"/i.exec(arguments[1]);data=this.getCache(cache_id[1]);if(data){var isQQVideo=/^http:\/\/((\w+\.|)(video|v|tv)).qq.com/i.test(data[1]);var url=(['<embed class="blog_video"',' allowNetworking="',(this.isInWhiteList(data[1])?'all" allowScriptAccess="always"':'internal"'),' id="',Math.random(),'" enableContextMenu="False" ',' width="',(data[3]||this.config.defaultVideoWidth),'"',' height="',(data[4]||this.config.defaultVideoHeight),'"','loop="',data[2],'" autostart="'+data[5]+'"',' showstatusbar="1" invokeURLs="false" src="'+data[1]+'" />']).join('');if(!isQQVideo){return url;}
return(['<object class="blog_video" id="',Math.random(),'" ','codeBase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab#version=8,0,0,0" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" ','width="',(data[3]||this.config.defaultVideoWidth),'" height="',(data[4]||this.config.defaultVideoHeight),'">','<param name="loop" value="',data[2],'" />','<param name="autostart" value="',data[5],'" />','<param name="movie" value="',data[1],'" />','<param name="allowFullScreen" value="true" />','<param name="wmode" value="transparent" />','<param name="allowScriptAccess" value="always" />','<param name="allownetworking" value="all" />',url,'</object>']).join('');}}}catch(err){console.log('qzonevideo onGetContent',err);}
return arguments[0];})));return str;},onInsertUBB:function(str){var reg=createRegEX('\\[video,(\\d+|true|false),(\\d+|true|false)(|,(true|false),(true|false))\\](.*?)\\[\\/video\\]','ig');str=str.replace(reg,ve.bind(this,function(){var w=arguments[3]?arguments[1]:this.config.defaultVideoWidth;var h=arguments[3]?arguments[2]:this.config.defaultVideoHeight;var r=arguments[3]?arguments[4]:arguments[1];var a=arguments[3]?arguments[5]:arguments[2];var data=[0,arguments[6],'define',w,h,a,r];var cache_id=this.setCache(data);return'<img src="/ac/b.gif" width="'+w+'" height="'+h+'" class="blog_video" style="width:'+w+'px;height:'+h+'px;" cache_id="'+cache_id+'" />';}));return str;}});v.plugin.register('qzonevideo',ve.plugin.QzoneVideo);})(ve);(function(v){v.Class('ve.plugin.ScreenShot',{editor:null,uploader:null,uploadURL:null,userLocation:null,bCheckUserLocationSending:false,DIYClipBoardImg:0,loginUin:null,init:function(editor,url){this.editor=editor;this.editor.addCommand('showScreenShotPanel',ve.bind(this,this.start));this.editor.addButton('showScreenShotPanel',{to:'group4',at:2,'class':'veScreen',title:'截屏',cmd:'showScreenShotPanel'});this.editor.onKeyDown.add(ve.bind(this,this.pasteEvent));this.loginUin=top.g_iLoginUin;},start:function(){if(!v.isIE&&!v.isGecko){this.editor.showStatusbar('很抱歉，目前截屏功能只支持ie和firefox浏览器。');return;}
this.doCapture();},doCapture:function(){var screencapture=this.getCaptureObject('ScreenCapture');if(!screencapture){this.installCaptureObject();return;}
screencapture.OnCaptureFinished=ve.bind(this,function(){this.prePaste();screencapture.BringToFront(window);var fileID=screencapture.SaveClipBoardBmpToFile(1);this.uploadPic(fileID);});screencapture.DoCapture();},installCaptureObject:function(){var gsAgent=navigator.userAgent.toLowerCase();var gbIsKHTML=(gsAgent.indexOf("khtml")>-1);var gbIsWin=(gsAgent.indexOf("windows")>-1||gsAgent.indexOf("win32")>-1);var gbIsFF=(gsAgent.indexOf("gecko")>-1&&!gbIsKHTML);var gsFFVer=/firefox\/((\d|\.)+)/i.test(gsAgent)&&RegExp["$1"];var mbAblePlugin=gbIsWin&&(gbIsFF&&gsFFVer.split(".")[0]>=3&&(gsFFVer.split(".")[1]>0||gsFFVer.split(".")[2]>=8||parseInt(navigator.buildID.substr(0,8))>=20090701));if(!mbAblePlugin&&!v.isIE){var dlg=new parent.QZONE.widget.Confirm("温馨提示","您当前使用的操作系统和firefox浏览器不适合安装截屏控件",3);dlg.show();return;}
var dlg=QZONE.FP.popupDialog('QQ空间截屏控件安装提示',{src:'http://'+IMGCACHE_DOMAIN+'/qzone/client/capture/install_hint.htm'},342,130);},getCaptureObject:function(id){var obj=null;try{if(ve.isIE){obj=new ActiveXObject('TXGYMailActiveX.'+id);}else{if(!$("ffScreenPlugin")){var oDiv=QZONE.dom.createElementIn("div",document.body,false);oDiv.innerHTML='<embed id="ffScreenPlugin" type="application/x-tencent-qmail" hidden="true"></embed>';}
var pluginObject=$('ffScreenPlugin');if(id=="ScreenCapture"){obj=pluginObject.CreateScreenCapture();}
else if(id=="Uploader"){obj=pluginObject.CreateUploader();}}}catch(ex){obj=null;}
return obj;},pasteEvent:function(e){if(e.ctrlKey&&(e.keyCode==86)||(e.keyCode==118)){var screencapture=this.getCaptureObject('ScreenCapture');if(!!screencapture&&screencapture.IsClipBoardImage){this.editorPaste(e);return false;}else{return true;}}
if(e.ctrlKey&&(e.keyCode==67)||(e.keyCode==99)){this.DIYClipBoardImg=0;}},prePaste:function(){if(!this.uploader){this.uploader=this.getCaptureObject('Uploader');}
if(!this.uploader){this.installCaptureObject();}else{this.uploader.OnEvent=ve.bind(this,this.uploaderOnEvent);}},uploaderOnEvent:function(obj,eventID,p1,p2,p3){if(eventID==1){QZFL.widget.msgbox.show('处理截图预览时遇到错误，请稍后再试。',1,3000);this.uploader.OnEvent=null;}else if(eventID==2){QZFL.widget.msgbox.show('正在处理图片预览，请稍候 : '+Math.round(p1/p2*100)+'%',1);}else if(eventID==3){if(!this.uploadDone(this.uploader.Response)){return;};this.pasteImg();}},doPaste:function(){var screencapture=this.getCaptureObject('ScreenCapture');if(!screencapture){return true;}
if(screencapture.IsClipBoardImage){this.prePaste();screencapture.BringToFront(window);var fileID=screencapture.SaveClipBoardBmpToFile(1);this.uploadPic(fileID);return false;}
if(this.DIYClipBoardImg==1){this.prePaste();screencapture.BringToFront(window);var fileID=this._tempFileID;this.uploadPic(fileID);return false;}
if(ua.ie&&ua.ie<=6){return false;}},uploadPic:function(fileID){if(!this.uploadURL){this.checkUserLocation(ve.bind(this,function(){this.uploadPic(fileID);}));return;}else if(this.uploadURL=="invalid"){var msg="暂时无法获取您当前的地理位置，请稍后再试。"
QZFL.widget.msgbox.show(msg,1,3000);return;}
if(fileID){this.uploader.URL=this.uploadURL;this.uploader.ClearFormItems();this.uploader.AddHeader('cookie',document.cookie);this.uploader.AddFormItem('picname2',1,0,fileID);this.uploader.AddFormItem('blogtype',0,0,this.blogType);this.uploader.AddFormItem('json',0,0,"1");this.uploader.AddFormItem('refer',0,0,'blog');this.uploader.StartUpload();}},checkUserLocation:function(callback){if(this.uploadURL||this.bCheckUserLocationSending){return;}
this.bCheckUserLocationSending=true;top.loadXMLAsync('checkUserLocation','http://route.store.qq.com/GetRoute?UIN='+this.loginUin,ve.bind(this,function(){var x=top.g_XDoc['checkUserLocation'];this.userLocation=x.getElementsByTagName('u')[0].firstChild.nodeValue;this.uploadURL="http://"+this.userLocation+"/cgi-bin/upload/cgi_upload_illustrated";this.bCheckUserLocationSending=false;callback();}),ve.bind(this,function(){this.bCheckUserLocationSending=false;this.checkUserLocation2(callback);}),true);},checkUserLocation2:function(callback){if(this.bCheckUserLocationSending){return;}
this.bCheckUserLocationSending=true;top.loadXMLAsync('checkUserLocationBackUp','http://rb.store.qq.com/GetRoute?UIN='+this.loginUin,ve.bind(this,function(){var x=top.g_XDoc['checkUserLocationBackUp'];this.userLocation=x.getElementsByTagName('u')[0].firstChild.nodeValue;this.uploadURL="http://"+this.userLocation+"/cgi-bin/upload/cgi_upload_illustrated";this.bCheckUserLocationSending=false;callback();}),function(){this.bCheckUserLocationSending=false;QZFL.widget.msgbox.show('无法正确获取您当前的地理位置，请稍后再试。',1,3000);this.uploadURL="invalid";},true);},pasteImg:function(){var src=QZFL.dataCenter.get('capturePic');QZFL.widget.msgbox.hide();try{QZONE.FP.closePopup();}catch(e){};if(typeof(src)!='undefined'){var html='<img src="'+src+'" alt="图片"/>';this.editor.setContent(html);QZFL.dataCenter.save("capturePic",null);}},uploadDone:function(str){var _r=/{.*}/ig;if(!str.match(_r)){QZFL.widget.msgbox.show('上传图片失败，请稍后再试。',1,3000);return false;}
var strMsg='';var o=eval("("+str+")");if(o.error!=null){strMsg=o.error;QZFL.widget.msgbox.show(strMsg,1,3000);return false;}
QZFL.dataCenter.save('capturePic',o.url);return true;},editorPaste:function(e){var screencapture=this.getCaptureObject('ScreenCapture');if(!screencapture){return;}
if(screencapture.IsClipBoardImage||(this.DIYClipBoardImg==1&&window.clipboardData.getData("Text")=="TencentMailPlugin_QZONE")){if(!this.uploadURL){this.checkUserLocation(this.doPaste);}else{this.doPaste();}
dom.event.cancel(e);}}});v.plugin.register('screenshot',ve.plugin.ScreenShot);})(ve);